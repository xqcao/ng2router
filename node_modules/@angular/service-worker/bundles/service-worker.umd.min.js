!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/add/observable/concat"),require("rxjs/add/observable/empty"),require("rxjs/add/observable/fromEvent"),require("rxjs/add/observable/merge"),require("rxjs/add/observable/of"),require("rxjs/add/observable/timer"),require("rxjs/add/operator/cache"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/map"),require("rxjs/add/operator/reduce"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/publishReplay"),require("rxjs/add/operator/take"),require("rxjs/add/operator/takeWhile"),require("@angular/core"),require("rxjs/Observable"),require("base64-js"),require("rxjs/add/observable/defer"),require("rxjs/add/observable/from"),require("rxjs/add/operator/do"),require("rxjs/add/operator/expand"),require("rxjs/add/operator/let"),require("rxjs/add/operator/share")):"function"==typeof define&&define.amd?define(["exports","rxjs/add/observable/concat","rxjs/add/observable/empty","rxjs/add/observable/fromEvent","rxjs/add/observable/merge","rxjs/add/observable/of","rxjs/add/observable/timer","rxjs/add/operator/cache","rxjs/add/operator/concatMap","rxjs/add/operator/filter","rxjs/add/operator/first","rxjs/add/operator/mergeMap","rxjs/add/operator/map","rxjs/add/operator/reduce","rxjs/add/operator/switchMap","rxjs/add/operator/publishReplay","rxjs/add/operator/take","rxjs/add/operator/takeWhile","@angular/core","rxjs/Observable","base64-js","rxjs/add/observable/defer","rxjs/add/observable/from","rxjs/add/operator/do","rxjs/add/operator/expand","rxjs/add/operator/let","rxjs/add/operator/share"],e):e((r.ng=r.ng||{},r.ng.serviceWorker=r.ng.serviceWorker||{}),r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.ng.core,r.Rx,r.Base64Js,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx,r.Rx)}(this,function(r,e,t,o,n,a,i,s,u,d,c,p,l,f,x,b,h,j,v,g,m,y,R,q,k,W,M){"use strict";function O(r){return g.Observable.create(function(e){r().then(function(r){return e.next(r)}).then(function(){return e.complete()}).catch(function(r){return e.error(r)})})}var w=function(){function r(r){this.ps=r}return r.prototype.auth=function(){return this.key("auth")},r.prototype.key=function(r){return void 0===r&&(r="p256dh"),m.fromByteArray(new Uint8Array(this.ps.getKey(r)))},Object.defineProperty(r.prototype,"url",{get:function(){return this.ps.endpoint},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"id",{get:function(){return this.ps.id},enumerable:!0,configurable:!0}),r.prototype.unsubscribe=function(){var r=this;return O(function(){return r.ps.unsubscribe()})},r}(),P=function(){function r(r){var e=this;this.zone=r,this.container=navigator.serviceWorker,this.controllingWorker=g.Observable.concat(g.Observable.of(this.container.controller),g.Observable.fromEvent(this.container,"controllerchange").map(function(r){return e.container.controller})).cache(1),this.awaitSingleControllingWorker=this.controllingWorker.filter(function(r){return!!r}).take(1),this.push=g.Observable.defer(function(){return e.send({cmd:"push"})}).share()}return r.prototype.registrationForWorker=function(){var r=this;return function(e){return e.switchMap(function(e,t){return O(function(){return r.container.getRegistrations()}).expand(function(r){return g.Observable.from(r)}).filter(function(r){return r.active===e}).take(1)})}},r.prototype.sendToWorker=function(r,e){var t=new MessageChannel,o=g.Observable.fromEvent(t.port1,"message").map(function(r){return r.data}).takeWhile(function(r){return!!r}).publishReplay();return o.connect(),t.port1.start(),e.$ngsw=!0,r.postMessage(e,[t.port2]),o},r.prototype.send=function(r){var e=this;return this.awaitSingleControllingWorker.switchMap(function(t){return e.sendToWorker(t,r)})},r.prototype.ping=function(){return this.send({cmd:"ping"})},r.prototype.log=function(){return this.send({cmd:"log"})},r.prototype.registerForPush=function(){var r=this;return this.awaitSingleControllingWorker.let(this.registrationForWorker()).map(function(r){return r.pushManager}).switchMap(function(e){var t=g.Observable.create(function(t){var o=function(r){return new w(r)};e.getSubscription().then(function(r){return r?o(r):e.subscribe({userVisibleOnly:!0}).then(o)}).then(function(e){return r.zone.run(function(){return t.next(e)})}).then(function(){return r.zone.run(function(){return t.complete()})}).catch(function(e){return r.zone.run(function(){return t.error(e)})})});return t})},r.decorators=[{type:v.Injectable}],r.ctorParameters=[{type:v.NgZone}],r}(),S=function(){function r(){}return r.decorators=[{type:v.NgModule,args:[{providers:[P]}]}],r.ctorParameters=[],r}();r.NgServiceWorker=P,r.NgPushRegistration=w,r.ServiceWorkerModule=S,Object.defineProperty(r,"__esModule",{value:!0})});